<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estação de Bebidas e Sabores</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      scroll-behavior: smooth;
      padding-top: 56px; /* Ajuste para a navbar fixa */
    }
    .hero {
      height: 400px;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .hero h1 {
      background-color: rgba(0,0,0,0.5);
      padding: 20px;
      border-radius: 10px;
      animation: fadeInDown 1s;
    }
    section { padding: 60px 0; }
    .card img {
      height: 200px;
      object-fit: cover;
      transition: transform 0.3s;
    }
    .card:hover img { transform: scale(1.05); }
    .card { transition: transform 0.3s, box-shadow 0.3s; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
    .btn:hover { transform: translateY(-2px); }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in { opacity: 0; transform: translateY(20px); }
    .fade-in.appear {
        animation: fadeUp 0.8s forwards;
    }
    @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <div class="container">
    <a class="navbar-brand" href="#home">Estação de Bebidas e Sabores</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="#home">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="#menu">Menu</a></li>
        <li class="nav-item"><a class="nav-link" href="#promocoes">Promoções</a></li>
        <li class="nav-item"><a class="nav-link" href="#pedidos">Pedidos</a></li>
        <li class="nav-item"><a class="nav-link" href="#sobre">Sobre</a></li>
        <li class="nav-item"><a class="nav-link" href="#contato">Contato</a></li>
        <li class="nav-item" id="admin-link" style="display: none;"><a class="nav-link fw-bold text-warning" href="#admin-panel">Painel Admin</a></li>
      </ul>
      <div id="auth-area">
        <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#authModal">Login / Cadastro</button>
      </div>
    </div>
  </div>
</nav>

<div id="home" class="hero" style="background: url('https://images.unsplash.com/photo-1551218808-94e220e084d2?crop=entropy&cs=tinysrgb&fit=crop&h=600&w=1200') center/cover no-repeat;">
  <h1>Bem-vindo à Estação de Bebidas e Sabores</h1>
</div>

<section id="menu" class="container">
  <h2 class="text-center mb-4">Nosso Menu</h2>
  <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?crop=entropy&cs=tinysrgb&fit=crop&h=400&w=1200" alt="Visão Geral do Menu" class="img-fluid rounded mb-5 fade-in">
  <div class="row">
    <div class="col-md-4 mb-4 fade-in" style="animation-delay: 0.2s;">
      <div class="card">
        <img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?crop=entropy&cs=tinysrgb&fit=crop&h=400&w=400" class="card-img-top" alt="Prato 1">
        <div class="card-body">
          <h5 class="card-title">Prato Executivo 1</h5>
          <p class="card-text">Preparado com ingredientes frescos, combina sabor e apresentação refinada.</p>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-4 fade-in" style="animation-delay: 0.4s;">
      <div class="card">
        <img src="https://images.unsplash.com/photo-1551183053-bf91a1d81141?crop=entropy&cs=tinysrgb&fit=crop&h=400&w=400" class="card-img-top" alt="Prato 2">
        <div class="card-body">
          <h5 class="card-title">Prato Executivo 2</h5>
          <p class="card-text">Sabor autêntico com apresentação sofisticada, ideal para qualquer refeição.</p>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-4 fade-in" style="animation-delay: 0.6s;">
      <div class="card">
        <img src="https://images.unsplash.com/photo-1519708227418-c8fd9a32b7a2?crop=entropy&cs=tinysrgb&fit=crop&h=400&w=400" class="card-img-top" alt="Prato 3">
        <div class="card-body">
          <h5 class="card-title">Prato Executivo 3</h5>
          <p class="card-text">Combinando texturas e sabores, prato gourmet para paladares exigentes.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="promocoes" class="bg-light">
  <div class="container">
    <h2 class="text-center mb-4">Promoções Especiais</h2>
    <img src="https://images.unsplash.com/photo-1579027989536-b7b1f87565ab?crop=entropy&cs=tinysrgb&fit=crop&h=400&w=1200" alt="Ofertas Especiais" class="img-fluid rounded mb-5 fade-in">
    <div class="row">
      <div class="col-md-4 mb-4 fade-in" style="animation-delay: 0.2s;">
        <div class="card">
          <img src="https://images.unsplash.com/photo-1550547660-d9450f859349?crop=entropy&cs=tinysrgb&fit=crop&h=400&w=400" class="card-img-top" alt="Promoção 1">
          <div class="card-body">
            <h5 class="card-title">Combo Executivo</h5>
            <p class="card-text">Prato + Bebida com 20% de desconto. Promoção válida por tempo limitado.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4 mb-4 fade-in" style="animation-delay: 0.4s;">
        <div class="card">
          <img src="https://images.pexels.com/photos/291528/pexels-photo-291528.jpeg?auto=compress&cs=tinysrgb&w=400" class="card-img-top" alt="Promoção 2 - Sobremesa">
          <div class="card-body">
            <h5 class="card-title">Sobremesa Grátis</h5>
            <p class="card-text">Na compra de qualquer prato principal, ganhe uma sobremesa de cortesia.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4 mb-4 fade-in" style="animation-delay: 0.6s;">
        <div class="card">
          <img src="https://images.pexels.com/photos/1269040/pexels-photo-1269040.jpeg?auto=compress&cs=tinysrgb&h=400&w=400" 
               class="card-img-top" 
               alt="Promoção 3 - Bebidas em Dobro">
          <div class="card-body">
            <h5 class="card-title">Bebida em Dobro</h5>
            <p class="card-text">Peça uma bebida e leve outra igual sem custo adicional.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<section id="pedidos" class="container">
  <h2 class="text-center mb-4">Faça seu Pedido</h2>
  <form id="pedidoForm">
    <h4 class="text-muted">1. Escolha seus itens</h4>
    <div class="mb-3">
      <label for="prato" class="form-label">Escolha o Prato</label>
      <select class="form-select" id="prato" required>
        <option value="">Selecione</option>
        <option value="Prato Executivo 1">Prato Executivo 1</option>
        <option value="Prato Executivo 2">Prato Executivo 2</option>
        <option value="Prato Executivo 3">Prato Executivo 3</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="bebida" class="form-label">Escolha a Bebida</label>
      <select class="form-select" id="bebida" required>
        <option value="">Selecione</option>
        <option value="Refrigerante">Refrigerante</option>
        <option value="Suco Natural">Suco Natural</option>
        <option value="Água">Água</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="observacao" class="form-label">Observações</label>
      <textarea class="form-control" id="observacao" rows="2" placeholder="Ex: Sem cebola, ponto da carne, etc."></textarea>
    </div>

    <h4 class="text-muted mt-5">2. Seus Dados para Entrega</h4>
    <div class="mb-3">
        <label for="endereco" class="form-label">Endereço Completo</label>
        <input type="text" class="form-control" id="endereco" placeholder="Rua, Número, Bairro, Complemento" required>
    </div>
     <div class="mb-3">
        <label for="telefone" class="form-label">Telefone para Contato</label>
        <input type="tel" class="form-control" id="telefone" placeholder="(XX) XXXXX-XXXX" required>
    </div>
    <div class="mb-3">
      <label for="pagamento" class="form-label">Forma de Pagamento</label>
      <select class="form-select" id="pagamento" required>
        <option value="">Selecione</option>
        <option value="Cartão de Crédito">Cartão de Crédito</option>
        <option value="Cartão de Débito">Cartão de Débito</option>
        <option value="PIX">PIX</option>
        <option value="Dinheiro">Dinheiro</option>
      </select>
    </div>
    
    <button type="submit" class="btn btn-success w-100 mt-4">Adicionar Pedido</button>
  </form>

  <h3 class="text-center mt-5 mb-4">Meus Pedidos</h3>
  <table class="table table-bordered text-center" id="pedidosTable">
    <thead class="table-dark">
      <tr>
        <th>Prato</th>
        <th>Bebida</th>
        <th>Observação</th>
        <th>Avaliação</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="admin-panel" class="bg-light" style="display: none;">
    <div class="container">
        <h2 class="text-center mb-4">Painel Administrativo</h2>
        
        <h4 class="text-muted mb-3">Relatório Simples</h4>
        <div class="row mb-5">
            <div class="col-md-4">
                <div class="card text-center text-white bg-primary">
                    <div class="card-body">
                        <h5 class="card-title">Total de Pedidos</h5>
                        <p class="card-text fs-2 fw-bold" id="report-total-pedidos">0</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center text-white bg-success">
                    <div class="card-body">
                        <h5 class="card-title">Prato Mais Pedido</h5>
                        <p class="card-text fs-4" id="report-prato-favorito">-</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center text-white bg-info">
                    <div class="card-body">
                        <h5 class="card-title">Bebida Mais Pedida</h5>
                        <p class="card-text fs-4" id="report-bebida-favorita">-</p>
                    </div>
                </div>
            </div>
        </div>

        <h4 class="text-muted mb-3">Todos os Pedidos</h4>

        <div class="mb-3">
            <input type="text" class="form-control" id="admin-search-input" placeholder="Buscar por E-mail do Cliente...">
        </div>
        
        <div class="table-responsive">
            <table class="table table-striped table-bordered text-center">
                <thead class="table-dark">
                    <tr>
                        <th>Cliente (E-mail)</th>
                        <th>Data</th>
                        <th>Prato</th>
                        <th>Bebida</th>
                        <th>Endereço</th>
                        <th>Telefone</th>
                        <th>Pagamento</th>
                        <th>Observação</th>
                        <th>Ações</th> 
                    </tr>
                </thead>
                <tbody id="admin-pedidos-body">
                </tbody>
            </table>
        </div>
    </div>
</section>

<section id="sobre" class="bg-light">
  <div class="container">
    <h2 class="text-center mb-4">Sobre Nós</h2>
    <p class="fade-in">Fundada em 2010, a Estação de Bebidas e Sabores oferece pratos de alta qualidade, feitos com ingredientes frescos e selecionados cuidadosamente.</p>
    <div class="row mt-4">
      <div class="col-md-6 fade-in">
        <img src="https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?crop=entropy&cs=tinysrgb&fit=crop&h=400&w=600" alt="Equipe ou Restaurante" class="img-fluid rounded">
      </div>
      <div class="col-md-6 fade-in">
        <h4>Missão</h4>
        <p>Oferecer uma experiência gastronômica de excelência, com atendimento cordial e pratos saborosos.</p>
        <h4>Valores</h4>
        <ul>
          <li>Qualidade e frescor dos ingredientes</li>
          <li>Atendimento atento e cordial</li>
          <li>Ambiente acolhedor e seguro</li>
          <li>Satisfação total do cliente</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<section id="contato" class="container mt-5">
  <h2 class="text-center mb-4">Contato</h2>
  <div class="row">
    <div class="col-md-6 fade-in">
      <h5>Endereço</h5>
      <p>Av. Paulista, 1500 - São Paulo, SP</p>
      <h5>Telefone</h5>
      <p>+55 11 99999-9999</p>
      <h5>E-mail</h5>
      <p>contato@estacaodebebidas.com.br</p>
      <h5>Redes Sociais</h5>
      <p>
        <a href="#">Instagram</a> | <a href="#">Facebook</a>
      </p>
    </div>
    <div class="col-md-6 fade-in">
      <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?crop=entropy&cs=tinysrgb&fit=crop&h=400&w=600" class="img-fluid rounded" alt="Contato">
    </div>
  </div>
</section>

<div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="authModalLabel">Autenticação</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <ul class="nav nav-tabs" id="authTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">Login</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab" aria-controls="register" aria-selected="false">Cadastro</button>
          </li>
        </ul>
        <div class="tab-content" id="authTabsContent">
          <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
            <form id="loginForm" class="mt-3">
              <div class="mb-3">
                <label for="loginEmail" class="form-label">Email</label>
                <input type="email" class="form-control" id="loginEmail" required>
              </div>
              <div class="mb-3">
                <label for="loginPassword" class="form-label">Senha</label>
                <input type="password" class="form-control" id="loginPassword" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">Entrar</button>
              <div class="text-center mt-2">
                <a href="#" data-bs-toggle="modal" data-bs-target="#forgotPasswordModal">Esqueceu a senha?</a>
              </div>
            </form>
          </div>
          <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
            <form id="registerForm" class="mt-3">
              <div class="mb-3">
                <label for="registerName" class="form-label">Nome Completo</label>
                <input type="text" class="form-control" id="registerName" required>
              </div>
              <div class="mb-3">
                <label for="registerEmail" class="form-label">Email</label>
                <input type="email" class="form-control" id="registerEmail" required>
              </div>
              <div class="mb-3">
                <label for="registerPassword" class="form-label">Senha</label>
                <input type="password" class="form-control" id="registerPassword" required>
              </div>
              <button type="submit" class="btn btn-success w-100">Cadastrar</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="forgotPasswordModalLabel">Recuperar Senha</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="forgotPasswordForm">
                    <div class="mb-3">
                        <label for="forgotEmail" class="form-label">Email Cadastrado</label>
                        <input type="email" class="form-control" id="forgotEmail" placeholder="Digite seu e-mail" required>
                    </div>
                    <p class="text-muted small">Um link para redefinição de senha será enviado para o seu e-mail.</p>
                    <button type="submit" class="btn btn-warning w-100">Enviar Link de Recuperação</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="avaliacaoModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Avalie o seu Pedido</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Por favor, selecione sua avaliação:</p>
        <select class="form-select" id="avaliacaoSelect">
          <option value="⭐">⭐</option>
          <option value="⭐⭐">⭐⭐</option>
          <option value="⭐⭐⭐">⭐⭐⭐</option>
          <option value="⭐⭐⭐⭐">⭐⭐⭐⭐</option>
          <option value="⭐⭐⭐⭐⭐" selected>⭐⭐⭐⭐⭐</option>
        </select>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        <button type="button" class="btn btn-primary" id="salvarAvaliacaoBtn">Salvar Avaliação</button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {

  const ADMIN_EMAIL = 'admin@admin.com';
  
  const faders = document.querySelectorAll('.fade-in');
  const appearOptions = { threshold: 0.2, rootMargin: "0px 0px -50px 0px" };
  const appearOnScroll = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        entry.target.classList.add('appear');
        observer.unobserve(entry.target);
      }
    });
  }, appearOptions);
  faders.forEach(fader => appearOnScroll.observe(fader));

  const pedidoForm = document.getElementById('pedidoForm');
  const tableBody = document.querySelector('#pedidosTable tbody');
  const avaliacaoModal = new bootstrap.Modal(document.getElementById('avaliacaoModal'));
  const salvarAvaliacaoBtn = document.getElementById('salvarAvaliacaoBtn');
  const avaliacaoSelect = document.getElementById('avaliacaoSelect');
  let linhaParaAvaliar = null;

  pedidoForm.addEventListener('submit', function(e){
    e.preventDefault();
    
    const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
    if (!loggedInUser) {
        alert('Você precisa estar logado para fazer um pedido.');
        return;
    }
    
    // Captura dos valores do formulário (incluindo os novos campos)
    const prato = document.getElementById('prato').value;
    const bebida = document.getElementById('bebida').value;
    const observacao = document.getElementById('observacao').value;
    const endereco = document.getElementById('endereco').value;
    const telefone = document.getElementById('telefone').value;
    const pagamento = document.getElementById('pagamento').value;
    
    // Validação dos campos
    if(!prato || !bebida || !endereco || !telefone || !pagamento) {
        alert('Por favor, preencha todos os campos obrigatórios.');
        return;
    }

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${prato}</td>
      <td>${bebida}</td>
      <td>${observacao || '-'}</td>
      <td class="avaliacao-cell">Pendente</td>
      <td>
        <button class="btn btn-primary btn-sm editar">Editar</button>
        <button class="btn btn-danger btn-sm deletar">Excluir</button>
        <button class="btn btn-info btn-sm avaliar">Avaliar</button>
      </td>
    `;
    tableBody.appendChild(row);

    // Salva o novo pedido com todos os dados no localStorage
    const allOrders = JSON.parse(localStorage.getItem('allOrders')) || [];
    const newOrder = {
        user: loggedInUser.email,
        prato,
        bebida,
        observacao,
        endereco,
        telefone,
        pagamento,
        date: new Date().toLocaleString('pt-BR')
    };
    allOrders.push(newOrder);
    localStorage.setItem('allOrders', JSON.stringify(allOrders));

    // Atualiza o painel admin se o admin estiver logado
    if (loggedInUser.email === ADMIN_EMAIL) {
        renderAdminPanel();
    }

    pedidoForm.reset();

    row.querySelector('.deletar').addEventListener('click', () => row.remove());
    
    row.querySelector('.editar').addEventListener('click', () => {
      // Ao editar, preenche todos os campos novamente
      document.getElementById('prato').value = prato;
      document.getElementById('bebida').value = bebida;
      document.getElementById('observacao').value = observacao;
      document.getElementById('endereco').value = endereco;
      document.getElementById('telefone').value = telefone;
      document.getElementById('pagamento').value = pagamento;
      row.remove(); // Remove a linha para ser adicionada novamente com as alterações
    });

    row.querySelector('.avaliar').addEventListener('click', () => {
      linhaParaAvaliar = row;
      avaliacaoModal.show();
    });
  });
  
  salvarAvaliacaoBtn.addEventListener('click', () => {
    if(linhaParaAvaliar){
      const avaliacao = avaliacaoSelect.value;
      const celulaAvaliacao = linhaParaAvaliar.querySelector('.avaliacao-cell');
      celulaAvaliacao.textContent = avaliacao;
      avaliacaoModal.hide();
      linhaParaAvaliar = null;
    }
  });

  // --- LÓGICA DE AUTENTICAÇÃO (sem alterações) ---
  const authArea = document.getElementById('auth-area');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  const forgotPasswordForm = document.getElementById('forgotPasswordForm');
  const authModal = new bootstrap.Modal(document.getElementById('authModal'));
  const forgotPasswordModal = new bootstrap.Modal(document.getElementById('forgotPasswordModal'));

  const getUsers = () => JSON.parse(localStorage.getItem('users')) || [];
  const saveUsers = (users) => localStorage.setItem('users', JSON.stringify(users));

  registerForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    
    const users = getUsers();

    if (users.find(user => user.email === email)) {
        alert('Este e-mail já está cadastrado.');
        return;
    }

    users.push({ name, email, password });
    saveUsers(users);
    alert('Cadastro realizado com sucesso! Por favor, faça o login.');
    registerForm.reset();
    const loginTab = new bootstrap.Tab(document.getElementById('login-tab'));
    loginTab.show();
  });

  loginForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    const users = getUsers();
    const user = users.find(u => u.email === email && u.password === password);

    if (user) {
        alert(`Bem-vindo, ${user.name}!`);
        localStorage.setItem('loggedInUser', JSON.stringify(user));
        updateAuthArea(user);
        authModal.hide();
    } else {
        alert('Email ou senha inválidos.');
    }
  });

  forgotPasswordForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const email = document.getElementById('forgotEmail').value;
    const users = getUsers();
    if(users.find(u => u.email === email)) {
        alert('Um e-mail de recuperação foi enviado para ' + email);
        forgotPasswordModal.hide();
    } else {
        alert('Nenhum usuário encontrado com este e-mail.');
    }
  });
  
  // --- LÓGICA DO PAINEL ADMIN ATUALIZADA ---
  function generateSimpleReport(allOrders) {
      document.getElementById('report-total-pedidos').textContent = allOrders.length;
      
      if (allOrders.length === 0) {
          document.getElementById('report-prato-favorito').textContent = '-';
          document.getElementById('report-bebida-favorita').textContent = '-';
          return;
      }

      const findMostFrequent = (array, key) => {
          const counts = array.reduce((acc, curr) => {
              acc[curr[key]] = (acc[curr[key]] || 0) + 1;
              return acc;
          }, {});
          if (Object.keys(counts).length === 0) return '-';
          return Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
      };

      const mostOrderedDish = findMostFrequent(allOrders, 'prato');
      const mostOrderedDrink = findMostFrequent(allOrders, 'bebida');

      document.getElementById('report-prato-favorito').textContent = mostOrderedDish;
      document.getElementById('report-bebida-favorita').textContent = mostOrderedDrink;
  }
  
  function renderAdminPanel(searchTerm = '') {
    const adminTableBody = document.getElementById('admin-pedidos-body');
    const allOrders = JSON.parse(localStorage.getItem('allOrders')) || [];
    
    generateSimpleReport(allOrders);

    const filteredOrders = allOrders.filter(order => 
        order.user.toLowerCase().includes(searchTerm.toLowerCase())
    );

    adminTableBody.innerHTML = ''; 

    if (filteredOrders.length === 0) {
        // Colspan atualizado para 9 colunas
        adminTableBody.innerHTML = '<tr><td colspan="9">Nenhum pedido encontrado.</td></tr>';
        return;
    }

    // Ordena os pedidos do mais recente para o mais antigo
    filteredOrders.sort((a, b) => new Date(b.date.split(', ')[0].split('/').reverse().join('-') + 'T' + b.date.split(', ')[1]) - new Date(a.date.split(', ')[0].split('/').reverse().join('-') + 'T' + a.date.split(', ')[1]));


    filteredOrders.forEach(order => {
        const row = document.createElement('tr');
        // Adiciona as novas colunas à tabela do admin
        row.innerHTML = `
            <td>${order.user}</td>
            <td>${order.date}</td>
            <td>${order.prato}</td>
            <td>${order.bebida}</td>
            <td>${order.endereco || '-'}</td>
            <td>${order.telefone || '-'}</td>
            <td>${order.pagamento || '-'}</td>
            <td>${order.observacao || '-'}</td>
            <td>
                <button class="btn btn-danger btn-sm admin-delete-btn" data-order-date="${order.date}">Excluir</button>
            </td>
        `;
        adminTableBody.appendChild(row);
    });
  }

  const adminSearchInput = document.getElementById('admin-search-input');
  if (adminSearchInput) {
      adminSearchInput.addEventListener('input', (e) => {
          renderAdminPanel(e.target.value);
      });
  }

  const adminTableBody = document.getElementById('admin-pedidos-body');
  if (adminTableBody) {
      adminTableBody.addEventListener('click', (e) => {
          if (e.target.classList.contains('admin-delete-btn')) {
              if (confirm('Tem certeza que deseja excluir este pedido?')) {
                  const orderDate = e.target.dataset.orderDate;
                  let allOrders = JSON.parse(localStorage.getItem('allOrders')) || [];
                  // A exclusão agora é mais segura, filtrando por data e usuário para evitar duplicidade
                  allOrders = allOrders.filter(order => !(order.date === orderDate && order.user === e.target.closest('tr').cells[0].textContent));
                  localStorage.setItem('allOrders', JSON.stringify(allOrders));
                  renderAdminPanel(adminSearchInput.value); // Re-renderiza com o filtro atual
              }
          }
      });
  }


  function updateAuthArea(user) {
    const adminLink = document.getElementById('admin-link');
    const adminPanel = document.getElementById('admin-panel');

    if (user) {
        authArea.innerHTML = `
            <span class="navbar-text text-white me-3">Olá, ${user.name}</span>
            <button class="btn btn-outline-danger" id="logoutBtn">Sair</button>
        `;
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('loggedInUser');
            updateAuthArea(null);
            tableBody.innerHTML = ''; 
        });

        if (user.email === ADMIN_EMAIL) {
            adminLink.style.display = 'block';
            adminPanel.style.display = 'block';
            renderAdminPanel();
        } else {
            adminLink.style.display = 'none';
            adminPanel.style.display = 'none';
        }

    } else {
        authArea.innerHTML = `
            <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#authModal">Login / Cadastro</button>
        `;
        adminLink.style.display = 'none';
        adminPanel.style.display = 'none';
    }
  }

  const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
  updateAuthArea(loggedInUser);

});
</script>

</body>
</html>